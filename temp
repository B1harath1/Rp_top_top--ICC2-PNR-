if {$argc < 1} {
	puts "ERROR: REPORT NOT SPECIFIED"
	exit
}

set file1 [lindex $argv 0]
set file2 [lindex $argv 1]
#set file1_inst_index [exec grep "Pins\|Instance" $file1]
#set file2_inst_index [lindex [lsearch [exec grep "Pins\|Instance" $file2] "Instance"]]
set list1 [exec awk -F "|" {{print $4}} $file1 | awk {NF} | awk {NF && $0 !~ /Instance/}]
set list2 [exec awk -F "|" {{print $4}} $file2 | awk {NF} | awk {NF && $0 !~ /Instance/}]

array set dict1 {}
array set dict2 {}

foreach item $list1 {
    set dict1($item) 1
}
foreach item $list2 {
    set dict2($item) 1
}
set common {}
foreach item $list1 {
    if {[info exists dict2($item)]} {
        lappend common $item
    }
}
set not_common_list1 {}
foreach item $list1 {
    if {![info exists dict2($item)]} {
        lappend not_common_list1 $item
    }
}
set not_common_list2 {}
foreach item $list2 {
    if {![info exists dict1($item)]} {
        lappend not_common_list2 $item
    }
}
puts "Common elements: $common"
puts "Not common in list1: $not_common_list1"
puts "Not common in list2: $not_common_list2"
###############################################################
if {$argc < 1} {
	puts "ERROR: REPORT NOT SPECIFIED"
	exit
}
set file1 [lindex $argv 0]
set file2 [lindex $argv 1]

set checks {"Unresolved References" "Empty Modules" "Unloaded Port" "Unloaded Sequential Pin" "Unloaded Combinational Pin" "Assigns" "Undriven Port" "Undriven Leaf Pin" "Undriven hierarchical pin" "Multidriven Port" "Multidriven Leaf Pin" "Multidriven hierarchical Pin" "Multidriven unloaded net" "Constant Port" "Constant Leaf Pin" "Constant hierarchical Pin" "Preserved leaf instance" "Preserved hierarchical instance" "Feedthrough Modules " "Libcells with no LEF cell" "Physical (LEF) cells with no libcell" "Subdesigns with long module name" "Physical only instance" "Logical only instance"}
set afile1 [string cat [lindex [splir $file1 "/"] end] "_" "only_present"]
set afile2 [string cat [lindex [splir $file2 "/"] end] "_" "only_present"]
set fp [open "$afile1" w]
set gp [open "$afile2" w]
foreach check $checks {
	if {$check eq "Unresolved References"} {
		set num1 [grep -B 28 "Done Checking the design." $file1 | grep "Unresolved References" | awk {{print $NF}}]
		set num2 [grep -B 28 "Done Checking the design." $file2 | grep "Unresolved References" | awk {{print $NF}}]
		set ur_file1 [exec sh -c [subst "grep -A $num 'following unresolved references' $file1 | grep 'hinst:'"]]
		set ur_file2 [exec sh -c [subst "grep -A $num 'following unresolved references' $file2 | grep 'hinst:'"]]
		puts $fp "unresolved references\n----------------------"
		puts $gp "unresolved references\n----------------------"
		diff $ur_file1 $ur_file2 $fp $gp
	}
	
}



proc diff {list1 list2 fp gp} {
	array set dict1 {}
	array set dict2 {}

	foreach item $list1 {
		set dict1($item) 1
	}
	foreach item $list2 {
		set dict2($item) 1
	}
	set common {}
	foreach item $list1 {
		if {[info exists dict2($item)]} {
			lappend common $item
		}
	}
	set not_common_list1 {}
	foreach item $list1 {
		if {![info exists dict2($item)]} {
			lappend not_common_list1 $item
		}
	}
	set not_common_list2 {}
	foreach item $list2 {
		if {![info exists dict1($item)]} {
			lappend not_common_list2 $item
		}
	}
#puts "Common elements: $common"
puts $fp [join $not_common_list1 "\n"]
puts $gp [join $not_common_list2 "\n"]
}
